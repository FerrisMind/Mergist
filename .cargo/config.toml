[build]
# По умолчанию не задаём target-cpu, чтобы кросс-сборки (в т.ч. universal) не падали.
rustflags = []

[target.x86_64-unknown-linux-gnu]
rustflags = [
  "-C", "target-cpu=x86-64",
  "-C", "link-arg=-fuse-ld=lld",
  "-C", "link-arg=-Wl,--gc-sections"
]

[target.aarch64-unknown-linux-gnu]
rustflags = [
  "-C", "target-cpu=generic",
  "-C", "link-arg=-fuse-ld=lld",
  "-C", "link-arg=-Wl,--gc-sections"
]

[target.x86_64-unknown-linux-musl]
rustflags = [
  "-C", "target-cpu=x86-64",
  "-C", "link-arg=-fuse-ld=lld",
  "-C", "link-arg=-Wl,--gc-sections"
]

[target.x86_64-pc-windows-msvc]
rustflags = ["-C", "target-cpu=x86-64", "-C", "link-arg=/OPT:REF", "-C", "link-arg=/OPT:ICF"]

[target.aarch64-pc-windows-msvc]
rustflags = ["-C", "target-cpu=generic", "-C", "link-arg=/OPT:REF", "-C", "link-arg=/OPT:ICF"]

[target.x86_64-apple-darwin]
rustflags = [
  "-C", "target-cpu=x86-64",
  "-C", "link-arg=-Wl,-dead_strip",
  "-C", "link-arg=-Wl,-dead_strip_dylibs"
]

[target.aarch64-apple-darwin]
rustflags = [
  "-C", "target-cpu=apple-m1",
  "-C", "link-arg=-Wl,-dead_strip",
  "-C", "link-arg=-Wl,-dead_strip_dylibs"
]